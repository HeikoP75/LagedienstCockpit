<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FEUER – Lagedienst Cockpit</title>

<link rel="stylesheet" href="assets/styles.css">

<style>
/* --- Basis-Kartenlayout für Maßnahmen --- */
.actionCard {
    background: #f4f4f4;
    padding: 16px;
    margin-bottom: 12px;
    border-radius: 14px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 6px solid #9e9e9e;
}

.actionCard.required {
    border-left-color: #d9534f; /* rot */
}

.actionCard.interval {
    border-left-color: #0275d8; /* blau */
}

.controls button {
    margin-left: 8px;
    padding: 6px 10px;
}

.title {
    font-size: 18px;
    font-weight: 600;
    max-width: 70%;
}
</style>

</head>
<body>

<h2>FEUER – Maßnahmen</h2>

<div id="actions"></div>

<script>
// -------------------------------------------------------------
// ENGINE 2.1 – Maßnahmensteuerung
// -------------------------------------------------------------

let actions = [];
let actionsById = {};
let uiContainer = null;

// ---------------------------------------------
// Maßnahmen laden (in dieser Datei direkt definiert)
// ---------------------------------------------

actions = [
    {
        id: "m01",
        title: "AP10 einschalten",
        status: "required",
        statusLock: true,
        hidden: false
    },
    {
        id: "m02",
        title: "Lagedatentool starten",
        status: "required",
        statusLock: true,
        hidden: false
    },
    {
        id: "m03",
        title: "KMvD informieren",
        status: "optional",
        hidden: false,
        onComplete: [
            {
                target: "m38",
                setStatus: "required",
                reveal: true,
                action: "promptLagebild"
            }
        ]
    },
    {
        id: "m38",
        title: "Erweitertes Lagebild ausfüllen & versenden",
        status: "optional",
        hidden: true
    },
    {
        id: "m05",
        title: "Absperrmaßnahmen prüfen",
        status: "optional",
        hidden: false
    },
    {
        id: "m06",
        title: "Lageerkundung durchführen",
        status: "optional",
        hidden: false
    }
];

// Index erzeugen
actions.forEach(a => actionsById[a.id] = a);


// ---------------------------------------------
// Rendering
// ---------------------------------------------
function renderActions() {
    uiContainer = document.getElementById("actions");
    uiContainer.innerHTML = "";

    actions.forEach(action => {
        if (action.hidden) return;

        let div = document.createElement("div");
        div.className = "actionCard " + action.status;

        div.innerHTML = `
            <div class="title">${action.title}</div>
            <div class="controls">
                <button onclick="toggleDone('${action.id}')">Erledigt</button>
                <button onclick="editAction('${action.id}')">✎</button>
            </div>
        `;

        uiContainer.appendChild(div);
    });
}


// ---------------------------------------------
// Erledigt-Logik + Abhängigkeiten
// ---------------------------------------------
function toggleDone(id) {
    const a = actionsById[id];
    a.completed = true;

    // Abhängigkeiten prüfen
    if (a.onComplete) {
        a.onComplete.forEach(rule => {
            const target = actionsById[rule.target];

            if (rule.setStatus) target.status = rule.setStatus;
            if (rule.reveal) target.hidden = false;

            if (rule.action === "promptLagebild") {
                alert("Erweitertes Lagebild ist jetzt erforderlich.\nBitte ausfüllen und versenden.");
            }
        });
    }

    renderActions();
}


// ---------------------------------------------
// Bearbeiten einer Maßnahme
// ---------------------------------------------
function editAction(id) {
    const m = actionsById[id];

    const newStatus = prompt(
        "Status wählen:\noptional / required / interval",
        m.status
    );

    if (!["optional", "required", "interval"].includes(newStatus)) return;

    // Pflichtschutz
    if (m.statusLock === true && newStatus !== "required") {
        alert("Diese Maßnahme ist zwingend und kann nicht auf optional gesetzt werden.");
        return;
    }

    // Warnung: required → optional
    if (m.status === "required" && newStatus === "optional") {
        const ok = confirm(
            "WARNUNG!\nDiese Maßnahme ist als zwingend definiert.\nSoll sie wirklich optional werden?"
        );
        if (!ok) return;
    }

    m.status = newStatus;
    renderActions();
}


// Erstes Rendering
renderActions();

</script>

</body>
</html>
